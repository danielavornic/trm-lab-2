<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <title>Memory Fragments - AR Experience</title>

    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div class="loading-screen" id="loadingScreen">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading AR Experience...</div>
    </div>

    <div class="ui-overlay">
      <div class="progress-bar">
        <span id="progressText">0/6 Fragments</span>
        <div class="progress-fill">
          <div class="progress-fill-inner" id="progressFill"></div>
        </div>
      </div>

      <div class="collected-fragments" id="fragmentsDisplay">
        <div class="fragment-icon" data-fragment="journal">
          <i class="fas fa-book"></i>
        </div>
        <div class="fragment-icon" data-fragment="toy">
          <i class="fas fa-cube"></i>
        </div>
        <div class="fragment-icon" data-fragment="photo">
          <i class="fas fa-camera"></i>
        </div>
        <div class="fragment-icon" data-fragment="letter">
          <i class="fas fa-envelope"></i>
        </div>
        <div class="fragment-icon" data-fragment="music-box">
          <i class="fas fa-music"></i>
        </div>
        <div class="fragment-icon" data-fragment="key">
          <i class="fas fa-key"></i>
        </div>
      </div>

      <div class="notification" id="notification"></div>

      <div class="narrative-panel" id="narrativePanel">
        <button class="close-btn" id="closeNarrative">Ã—</button>
        <div id="narrativeText"></div>
      </div>

      <div
        style="
          position: fixed;
          top: 80px;
          left: 10px;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 10px;
          font-size: 12px;
          z-index: 200;
          font-family: monospace;
        "
        id="debugLog"
      >
        Debug: Ready
      </div>

      <!-- AR Overlay Text (AR.js recommended approach) -->
      <div
        style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: gold;
          font-size: 24px;
          font-weight: bold;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
          z-index: 60;
          pointer-events: none;
          display: none;
          font-family: Arial, sans-serif;
        "
        id="arOverlayText"
      >
        UNLOCK
      </div>

      <div class="ar-tap-area" id="arTapArea"></div>
    </div>

    <a-scene
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; colorManagement: true; physicallyCorrectLights: true"
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    >
      <a-assets timeout="1000"> </a-assets>

      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity
        light="type: directional; intensity: 0.8"
        position="1 2 1"
      ></a-entity>
      <a-entity
        light="type: point; intensity: 0.5; color: #a8b3ff"
        position="0 2 0"
      ></a-entity>

      <a-nft
        type="nft"
        url="markers/journal/journal"
        smooth="true"
        smoothCount="20"
        smoothTolerance="0.5"
        smoothThreshold="10"
        data-marker-id="journal"
      >
        <a-entity
          position="40 -400 0"
          rotation="90 0 0"
          scale="300 300 300"
          fragment-collector="fragmentId: journal; narrativeText: A locked journal. The first memory begins here..."
          class="interactive"
          visible="true"
        >
          <a-box
            position="0 0 0"
            width="1.5"
            height="1.5"
            depth="0.5"
            material="opacity: 0; transparent: true"
          ></a-box>

          <!-- Crystal/diamond shape for journal -->
          <a-octahedron
            position="0 0 0"
            radius="0.35"
            material="color: #8B4513; metalness: 0.7; roughness: 0.2"
          >
            <a-animation
              attribute="rotation"
              to="0 360 360"
              dur="5000"
              repeat="indefinite"
              easing="linear"
            ></a-animation>
          </a-octahedron>
        </a-entity>
      </a-nft>

      <a-nft
        type="nft"
        url="markers/toy/toy"
        smooth="true"
        smoothCount="20"
        smoothTolerance="0.5"
        smoothThreshold="10"
        data-marker-id="toy"
      >
        <a-entity
          position="0 -400 0"
          rotation="90 0 0"
          scale="300 300 300"
          fragment-collector="fragmentId: toy; narrativeText: A worn childhood toy. It smells like distant summers..."
          class="interactive"
          visible="true"
        >
          <a-box
            position="0 0 0"
            width="1.5"
            height="1.5"
            depth="0.5"
            material="opacity: 0; transparent: true"
          ></a-box>

          <a-sphere
            position="0 0 0"
            radius="0.3"
            material="color: #FFB6C1; metalness: 0.2; roughness: 0.8"
          >
            <a-animation
              attribute="rotation"
              to="0 360 0"
              dur="3000"
              repeat="indefinite"
              easing="linear"
            ></a-animation>
          </a-sphere>
        </a-entity>
      </a-nft>

      <a-nft
        type="nft"
        url="markers/photo/photo"
        smooth="true"
        smoothCount="20"
        smoothTolerance="0.5"
        smoothThreshold="10"
        data-marker-id="photo"
      >
        <a-entity
          position="80 -400 0"
          rotation="90 0 0"
          scale="250 250 250"
          fragment-collector="fragmentId: photo; narrativeText: A faded photograph. Two smiling faces, frozen in time..."
          class="interactive"
          visible="true"
        >
          <a-box
            position="0 0 0"
            width="1.5"
            height="1.5"
            depth="0.5"
            material="opacity: 0; transparent: true"
          ></a-box>

          <a-torus
            position="0 0 0"
            radius="0.4"
            radius-tubular="0.08"
            material="color: #FFFFFF; metalness: 0.3; roughness: 0.7"
            rotation="0 0 0"
          >
            <a-animation
              attribute="rotation"
              to="0 360 0"
              dur="5000"
              repeat="indefinite"
              easing="linear"
            ></a-animation>
          </a-torus>
        </a-entity>
      </a-nft>

      <a-nft
        type="nft"
        url="markers/music-box/music-box"
        smooth="true"
        smoothCount="20"
        smoothTolerance="0.5"
        smoothThreshold="10"
        data-marker-id="music-box"
      >
        <a-entity
          position="100 -510 10"
          rotation="90 0 0"
          scale="270 270 270"
          fragment-collector="fragmentId: music-box; narrativeText: A delicate music box. Its melody echoes a happy ending..."
          class="interactive"
          visible="true"
        >
          <a-box
            position="0 0 0"
            width="1.5"
            height="1.5"
            depth="0.5"
            material="opacity: 0; transparent: true"
          ></a-box>

          <a-entity position="0 0 0">
            <a-box
              position="0 0 0"
              width="0.6"
              height="0.4"
              depth="0.3"
              material="color: #8B4513; metalness: 0.4; roughness: 0.6"
            ></a-box>

            <!-- Golden cylinders for mechanism -->
            <a-cylinder
              position="0 0.15 0"
              radius="0.08"
              height="0.1"
              material="color: #FFD700; metalness: 0.8; roughness: 0.2"
            ></a-cylinder>

            <a-cylinder
              position="-0.15 0.15 0"
              radius="0.06"
              height="0.08"
              material="color: #FFD700; metalness: 0.8; roughness: 0.2"
            ></a-cylinder>

            <a-cylinder
              position="0.15 0.15 0"
              radius="0.06"
              height="0.08"
              material="color: #FFD700; metalness: 0.8; roughness: 0.2"
            ></a-cylinder>

            <!-- Gentle rotation animation -->
            <a-animation
              attribute="rotation"
              to="0 360 0"
              dur="7000"
              repeat="indefinite"
              easing="linear"
            ></a-animation>
          </a-entity>
        </a-entity>
      </a-nft>

      <!-- COMMENTED OUT - Create letter marker first -->
      <!-- <a-nft
        type="nft"
        url="markers/photo/photo"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        marker-tracker="markerId: photo"
      >
        <a-entity
          position="0 0 0"
          scale="20 20 20"
          fragment-collector="fragmentId: photo; narrativeText: A faded photograph. Two smiling faces, frozen in time..."
          unlock-trigger="requiredFragments: toy"
          pulse-animation="speed: 1800"
          glow-ring="color: #F5DEB3"
        >
          <a-plane
            position="0 0 0"
            width="0.6"
            height="0.4"
            material="color: #F5DEB3; metalness: 0.1; roughness: 0.9; emissive: #F5DEB3; emissiveIntensity: 0.2"
            rotation="0 0 0"
          >
          </a-plane>
          <a-text
            value="Photo"
            align="center"
            color="#000000"
            width="2"
            position="0 0.35 0.01"
          ></a-text>
        </a-entity>
      </a-nft> -->

      <!-- COMMENTED OUT - Create letter marker first -->
      <!-- <a-nft
        type="nft"
        url="markers/letter/letter"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        marker-tracker="markerId: letter"
      >
        <a-entity
          position="0 0 0"
          scale="20 20 20"
          fragment-collector="fragmentId: letter; narrativeText: An unopened letter. Some words are better left unsaid..."
          unlock-trigger="requiredFragments: toy"
          pulse-animation="speed: 2200"
          glow-ring="color: #FFFACD"
        >
          <a-plane
            position="0 0 0"
            width="0.4"
            height="0.6"
            material="color: #FFFACD; metalness: 0.1; roughness: 0.9; emissive: #FFFACD; emissiveIntensity: 0.2"
            rotation="0 0 0"
          >
          </a-plane>
          <a-text
            value="Letter"
            align="center"
            color="#8B0000"
            width="2"
            position="0 0.4 0.01"
          ></a-text>
        </a-entity>
      </a-nft> -->

      <!-- COMMENTED OUT - Create music-box marker first -->
      <!-- <a-nft
        type="nft"
        url="markers/music-box/music-box"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        marker-tracker="markerId: music-box"
      >
        <a-entity
          position="0 0 0"
          scale="20 20 20"
          fragment-collector="fragmentId: music-box; narrativeText: A delicate music box. Its melody echoes a happy ending..."
          unlock-trigger="requiredFragments: photo"
          rotate-slow="speed: 12000"
          glow-ring="color: #DDA0DD"
        >
          <a-box
            position="0 0 0"
            width="0.4"
            height="0.3"
            depth="0.4"
            material="color: #DDA0DD; metalness: 0.4; roughness: 0.6; emissive: #DDA0DD; emissiveIntensity: 0.3"
          >
          </a-box>
          <a-cylinder
            position="0 0.2 0"
            radius="0.1"
            height="0.05"
            material="color: #FFD700; metalness: 0.8; roughness: 0.2"
          >
          </a-cylinder>
          <a-text
            value="Music Box"
            align="center"
            color="#ffffff"
            width="2"
            position="0 0.5 0"
          ></a-text>
        </a-entity>
      </a-nft>

      <a-nft
        type="nft"
        url="markers/key/key"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        marker-tracker="markerId: key"
      >
        <a-entity
          position="0 0 0"
          scale="20 20 20"
          fragment-collector="fragmentId: key; narrativeText: An old key. Some doors are meant to stay locked..."
          unlock-trigger="requiredFragments: letter"
          rotate-slow="speed: 10000"
          glow-ring="color: #C0C0C0"
        >
          <a-cylinder
            position="0 0 0"
            radius="0.05"
            height="0.6"
            material="color: #C0C0C0; metalness: 0.9; roughness: 0.3; emissive: #C0C0C0; emissiveIntensity: 0.4"
            rotation="0 0 90"
          >
          </a-cylinder>
          <a-torus
            position="-0.3 0 0"
            radius="0.1"
            radius-tubular="0.03"
            material="color: #C0C0C0; metalness: 0.9; roughness: 0.3; emissive: #C0C0C0; emissiveIntensity: 0.4"
            rotation="0 90 0"
          >
          </a-torus>
          <a-text
            value="Key"
            align="center"
            color="#ffffff"
            width="2"
            position="0 0.4 0"
          ></a-text>
        </a-entity>
      </a-nft> -->

      <!-- COMMENTED OUT - Create key marker first -->
      <!-- <a-nft
        type="nft"
        url="markers/key/key"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        marker-tracker="markerId: key"
      >
        <a-entity
          position="0 0 0"
          scale="20 20 20"
          fragment-collector="fragmentId: key; narrativeText: An old key. Some doors are meant to stay locked..."
          unlock-trigger="requiredFragments: letter"
          rotate-slow="speed: 10000"
          glow-ring="color: #C0C0C0"
        >
          <a-cylinder
            position="0 0 0"
            radius="0.05"
            height="0.6"
            material="color: #C0C0C0; metalness: 0.9; roughness: 0.3; emissive: #C0C0C0; emissiveIntensity: 0.4"
            rotation="0 0 90"
          >
          </a-cylinder>
          <a-torus
            position="-0.3 0 0"
            radius="0.1"
            radius-tubular="0.03"
            material="color: #C0C0C0; metalness: 0.9; roughness: 0.3; emissive: #C0C0C0; emissiveIntensity: 0.4"
            rotation="0 90 0"
          >
          </a-torus>
          <a-text
            value="Key"
            align="center"
            color="#ffffff"
            width="2"
            position="0 0.4 0"
          ></a-text>
        </a-entity>
      </a-nft> -->

      <a-entity camera></a-entity>
    </a-scene>

    <script src="js/game-state.js"></script>
    <script src="js/components.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
